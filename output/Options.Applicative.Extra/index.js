// Generated by purs version 0.14.5
"use strict";
var Control_Alt = require("../Control.Alt/index.js");
var Control_Applicative = require("../Control.Applicative/index.js");
var Control_Apply = require("../Control.Apply/index.js");
var Control_Bind = require("../Control.Bind/index.js");
var Data_Array = require("../Data.Array/index.js");
var Data_Boolean = require("../Data.Boolean/index.js");
var Data_Either = require("../Data.Either/index.js");
var Data_Enum = require("../Data.Enum/index.js");
var Data_Eq = require("../Data.Eq/index.js");
var Data_Exists = require("../Data.Exists/index.js");
var Data_Foldable = require("../Data.Foldable/index.js");
var Data_Function = require("../Data.Function/index.js");
var Data_Functor = require("../Data.Functor/index.js");
var Data_List = require("../Data.List/index.js");
var Data_Maybe = require("../Data.Maybe/index.js");
var Data_Monoid = require("../Data.Monoid/index.js");
var Data_Newtype = require("../Data.Newtype/index.js");
var Data_Semigroup = require("../Data.Semigroup/index.js");
var Data_String_CodeUnits = require("../Data.String.CodeUnits/index.js");
var Data_String_Common = require("../Data.String.Common/index.js");
var Data_Tuple = require("../Data.Tuple/index.js");
var Data_Unit = require("../Data.Unit/index.js");
var Effect = require("../Effect/index.js");
var ExitCodes = require("../ExitCodes/index.js");
var Node_Encoding = require("../Node.Encoding/index.js");
var Node_Process = require("../Node.Process/index.js");
var Node_Stream = require("../Node.Stream/index.js");
var Options_Applicative_BashCompletion = require("../Options.Applicative.BashCompletion/index.js");
var Options_Applicative_Builder = require("../Options.Applicative.Builder/index.js");
var Options_Applicative_Builder_Internal = require("../Options.Applicative.Builder.Internal/index.js");
var Options_Applicative_Common = require("../Options.Applicative.Common/index.js");
var Options_Applicative_Help_Chunk = require("../Options.Applicative.Help.Chunk/index.js");
var Options_Applicative_Help_Core = require("../Options.Applicative.Help.Core/index.js");
var Options_Applicative_Help_Levenshtein = require("../Options.Applicative.Help.Levenshtein/index.js");
var Options_Applicative_Help_Types = require("../Options.Applicative.Help.Types/index.js");
var Options_Applicative_Internal = require("../Options.Applicative.Internal/index.js");
var Options_Applicative_Internal_Utils = require("../Options.Applicative.Internal.Utils/index.js");
var Options_Applicative_Types = require("../Options.Applicative.Types/index.js");
var Text_PrettyPrint_Leijen = require("../Text.PrettyPrint.Leijen/index.js");
var renderFailure = function (failure) {
    return function (progn) {
        var v = Data_Newtype.un()(Options_Applicative_Types.ParserFailure)(failure)(progn);
        return new Data_Tuple.Tuple(Options_Applicative_Help_Types.renderHelp(v.value1.value1.value0)(v.value0), v.value1.value0);
    };
};
var parserFailure = function (pprefs) {
    return function (pinfo) {
        return function (msg) {
            return function (ctx) {
                var with_context = function (arr) {
                    return function (i) {
                        return function (f) {
                            var v = Data_Array.head(arr);
                            if (v instanceof Data_Maybe.Nothing) {
                                return f([  ])(i);
                            };
                            if (v instanceof Data_Maybe.Just) {
                                return Data_Exists.runExists(function (i$prime) {
                                    return f(Options_Applicative_Internal.contextNames(arr))(i$prime);
                                })(v.value0.value1);
                            };
                            throw new Error("Failed pattern match at Options.Applicative.Extra (line 183, column 28 - line 185, column 73): " + [ v.constructor.name ]);
                        };
                    };
                };
                var usage_help = function (progn) {
                    return function (names) {
                        return function (v) {
                            if (msg instanceof Options_Applicative_Types.InfoMsg) {
                                return Data_Monoid.mempty(Options_Applicative_Help_Types.parserHelpMonoid);
                            };
                            return Options_Applicative_Help_Core.usageHelp(Options_Applicative_Help_Chunk.vcatChunks([ Control_Applicative.pure(Options_Applicative_Help_Chunk.chunkApplicative)(Options_Applicative_Help_Core.parserUsage(pprefs)(v.infoParser)(Options_Applicative_Internal_Utils.unWords(Data_Foldable.foldableArray)(Data_Semigroup.append(Data_Semigroup.semigroupArray)([ progn ])(names)))), Data_Functor.map(Options_Applicative_Help_Chunk.chunkFunctor)(Text_PrettyPrint_Leijen.indent(2))(v.infoProgDesc) ]));
                        };
                    };
                };
                var suggestion_help = Options_Applicative_Help_Core.suggestionsHelp((function () {
                    if (msg instanceof Options_Applicative_Types.UnexpectedError) {
                        var opt_completions = function (v) {
                            return function (v1) {
                                if (v1.optMain instanceof Options_Applicative_Types.OptReader) {
                                    return Data_Functor.map(Data_Functor.functorArray)(Options_Applicative_Common.showOption)(v1.optMain.value0);
                                };
                                if (v1.optMain instanceof Options_Applicative_Types.FlagReader) {
                                    return Data_Functor.map(Data_Functor.functorArray)(Options_Applicative_Common.showOption)(v1.optMain.value0);
                                };
                                if (v1.optMain instanceof Options_Applicative_Types.ArgReader) {
                                    return [  ];
                                };
                                if (v1.optMain instanceof Options_Applicative_Types.CmdReader) {
                                    if (v.hinfoUnreachableArgs) {
                                        return [  ];
                                    };
                                    if (Data_Boolean.otherwise) {
                                        return v1.optMain.value1;
                                    };
                                };
                                throw new Error("Failed pattern match at Options.Applicative.Extra (line 273, column 64 - line 280, column 37): " + [ v1.optMain.constructor.name ]);
                            };
                        };
                        var possibles = Data_Array.fold(Data_Monoid.monoidArray)(Data_Exists.runExists(function (zz) {
                            return Options_Applicative_Common.mapParser(opt_completions)(zz);
                        })(msg.value1.value0));
                        var isClose = function (a) {
                            return Data_Function.on(Options_Applicative_Help_Levenshtein.editDistance(Data_Eq.eqChar))(Data_String_CodeUnits.toCharArray)(a)(msg.value0) < 3;
                        };
                        var good = Data_Array.filter(isClose)(possibles);
                        var prose = (function () {
                            var $43 = Data_Array.length(good) < 2;
                            if ($43) {
                                return Options_Applicative_Help_Chunk.stringChunk("Did you mean this?");
                            };
                            return Options_Applicative_Help_Chunk.stringChunk("Did you mean one of these?");
                        })();
                        var suggestions = Control_Apply.apply(Options_Applicative_Help_Chunk.chunkApply)(Data_Functor.map(Options_Applicative_Help_Chunk.chunkFunctor)(Text_PrettyPrint_Leijen.appendWithLine)(prose))(Data_Functor.map(Options_Applicative_Help_Chunk.chunkFunctor)(Text_PrettyPrint_Leijen.indent(4))(Options_Applicative_Help_Chunk.vcatChunks(Data_Functor.map(Data_Functor.functorArray)(Options_Applicative_Help_Chunk.stringChunk)(good))));
                        return suggestions;
                    };
                    return Data_Monoid.mempty(Options_Applicative_Help_Chunk.chunkMonoid(Text_PrettyPrint_Leijen.docSemigroup));
                })());
                var show_full_help = (function () {
                    if (msg instanceof Options_Applicative_Types.ShowHelpText) {
                        return true;
                    };
                    if (msg instanceof Options_Applicative_Types.MissingError && (msg.value0 instanceof Options_Applicative_Types.CmdStart && (Data_Newtype.un()(Options_Applicative_Types.ParserPrefs)(pprefs)).prefShowHelpOnEmpty)) {
                        return true;
                    };
                    return (Data_Newtype.un()(Options_Applicative_Types.ParserPrefs)(pprefs)).prefShowHelpOnError;
                })();
                var exit_code = (function () {
                    if (msg instanceof Options_Applicative_Types.ErrorMsg) {
                        return (Data_Newtype.un()(Options_Applicative_Types.ParserInfo)(pinfo)).infoFailureCode;
                    };
                    if (msg instanceof Options_Applicative_Types.MissingError) {
                        return (Data_Newtype.un()(Options_Applicative_Types.ParserInfo)(pinfo)).infoFailureCode;
                    };
                    if (msg instanceof Options_Applicative_Types.ExpectsArgError) {
                        return (Data_Newtype.un()(Options_Applicative_Types.ParserInfo)(pinfo)).infoFailureCode;
                    };
                    if (msg instanceof Options_Applicative_Types.UnexpectedError) {
                        return (Data_Newtype.un()(Options_Applicative_Types.ParserInfo)(pinfo)).infoFailureCode;
                    };
                    if (msg instanceof Options_Applicative_Types.ShowHelpText) {
                        return ExitCodes.Success.value;
                    };
                    if (msg instanceof Options_Applicative_Types.InfoMsg) {
                        return ExitCodes.Success.value;
                    };
                    throw new Error("Failed pattern match at Options.Applicative.Extra (line 171, column 17 - line 177, column 44): " + [ msg.constructor.name ]);
                })();
                var error_help = Options_Applicative_Help_Core.errorHelp((function () {
                    if (msg instanceof Options_Applicative_Types.ShowHelpText) {
                        return Data_Monoid.mempty(Options_Applicative_Help_Chunk.chunkMonoid(Text_PrettyPrint_Leijen.docSemigroup));
                    };
                    if (msg instanceof Options_Applicative_Types.ErrorMsg) {
                        return Options_Applicative_Help_Chunk.stringChunk(msg.value0);
                    };
                    if (msg instanceof Options_Applicative_Types.InfoMsg) {
                        return Options_Applicative_Help_Chunk.stringChunk(msg.value0);
                    };
                    if (msg instanceof Options_Applicative_Types.MissingError && (msg.value0 instanceof Options_Applicative_Types.CmdStart && (Data_Newtype.un()(Options_Applicative_Types.ParserPrefs)(pprefs)).prefShowHelpOnEmpty)) {
                        return Data_Monoid.mempty(Options_Applicative_Help_Chunk.chunkMonoid(Text_PrettyPrint_Leijen.docSemigroup));
                    };
                    if (msg instanceof Options_Applicative_Types.MissingError) {
                        return Data_Exists.runExists(function (x) {
                            return Options_Applicative_Help_Chunk.chunkBeside(Options_Applicative_Help_Chunk.stringChunk("Missing:"))(Options_Applicative_Help_Core.missingDesc(pprefs)(x));
                        })(msg.value1.value0);
                    };
                    if (msg instanceof Options_Applicative_Types.ExpectsArgError) {
                        return Options_Applicative_Help_Chunk.stringChunk("The option `" + (msg.value0 + "` expects an argument."));
                    };
                    if (msg instanceof Options_Applicative_Types.UnexpectedError) {
                        var msg$prime = (function () {
                            var $67 = Options_Applicative_Internal_Utils.startsWith("-")(msg.value0);
                            if ($67) {
                                return "Invalid option `" + (msg.value0 + "'");
                            };
                            return "Invalid argument `" + (msg.value0 + "'");
                        })();
                        return Options_Applicative_Help_Chunk.stringChunk(msg$prime);
                    };
                    throw new Error("Failed pattern match at Options.Applicative.Extra (line 196, column 30 - line 225, column 30): " + [ msg.constructor.name ]);
                })());
                var base_help = function (v) {
                    var h = Options_Applicative_Help_Core.headerHelp(v.infoHeader);
                    var f = Options_Applicative_Help_Core.footerHelp(v.infoFooter);
                    if (show_full_help) {
                        return Data_Array.fold(Options_Applicative_Help_Types.parserHelpMonoid)([ h, f, Options_Applicative_Help_Core.parserHelp(pprefs)(v.infoParser) ]);
                    };
                    return Data_Monoid.mempty(Options_Applicative_Help_Types.parserHelpMonoid);
                };
                return Options_Applicative_Types.ParserFailure(function (progn) {
                    var h = with_context(ctx)(pinfo)(function (names) {
                        return function (pinfo$prime) {
                            return Data_Array.fold(Options_Applicative_Help_Types.parserHelpMonoid)([ base_help(pinfo$prime), usage_help(progn)(names)(pinfo$prime), suggestion_help, error_help ]);
                        };
                    });
                    return new Data_Tuple.Tuple(h, new Data_Tuple.Tuple(exit_code, new Data_Tuple.Tuple((Data_Newtype.un()(Options_Applicative_Types.ParserPrefs)(pprefs)).prefColumns, Data_Unit.unit)));
                });
            };
        };
    };
};
var helper = Options_Applicative_Builder.abortOption(Options_Applicative_Types.ShowHelpText.value)(Data_Array.fold(Options_Applicative_Builder_Internal.modMonoid)([ Options_Applicative_Builder["long"](Options_Applicative_Builder_Internal.optionFieldsHasName)("help"), Options_Applicative_Builder["short"](Options_Applicative_Builder_Internal.optionFieldsHasName)("h"), Options_Applicative_Builder.help("Show this help text"), Options_Applicative_Builder.hidden ]));
var hsubparser = function (m) {
    var v = Data_Semigroup.append(Options_Applicative_Builder_Internal.modSemigroup)(Options_Applicative_Builder.metavar(Options_Applicative_Builder_Internal.commandFieldsHasMetavar)("COMMAND"))(m);
    var v1 = Options_Applicative_Builder_Internal.mkCommand(m);
    var add_helper = Data_Newtype.over()()(Options_Applicative_Types.ParserInfo)(function (pinfo) {
        return {
            infoParser: Options_Applicative_Internal_Utils.apApplyFlipped(Options_Applicative_Types.parserApply)(pinfo.infoParser)(helper),
            infoFailureCode: pinfo.infoFailureCode,
            infoFooter: pinfo.infoFooter,
            infoFullDesc: pinfo.infoFullDesc,
            infoHeader: pinfo.infoHeader,
            infoPolicy: pinfo.infoPolicy,
            infoProgDesc: pinfo.infoProgDesc
        };
    });
    var rdr = new Options_Applicative_Types.CmdReader(v1.value0, v1.value1.value0, (function () {
        var $105 = Data_Functor.map(Data_Maybe.functorMaybe)(add_helper);
        return function ($106) {
            return $105(v1.value1.value1.value0($106));
        };
    })());
    return Options_Applicative_Builder_Internal.mkParser(v.value1)(v.value2)(rdr);
};
var getProgName = Data_Functor.mapFlipped(Effect.functorEffect)(Node_Process.argv)(function (args) {
    return Data_Maybe.fromMaybe("")(Control_Bind.bind(Data_Maybe.bindMaybe)(Data_Array.index(args)(1))(function (executablePath) {
        return Data_Array.last(Data_String_Common.split("/")(executablePath));
    }));
});
var getParseResult = function (v) {
    if (v instanceof Options_Applicative_Types.Success) {
        return new Data_Maybe.Just(v.value0);
    };
    return Data_Maybe.Nothing.value;
};
var getArgs = Data_Functor.mapFlipped(Effect.functorEffect)(Node_Process.argv)(Data_Array.drop(2));
var exitWith = function (c) {
    return Node_Process.exit(Data_Enum.fromEnum(ExitCodes.boundedEnumExitCode)(c));
};
var exitSuccess = Node_Process.exit(Data_Enum.fromEnum(ExitCodes.boundedEnumExitCode)(ExitCodes.Success.value));
var handleParseResult = function (v) {
    if (v instanceof Options_Applicative_Types.Success) {
        return Control_Applicative.pure(Effect.applicativeEffect)(v.value0);
    };
    if (v instanceof Options_Applicative_Types.Failure) {
        return function __do() {
            var progn = getProgName();
            var v1 = renderFailure(v.value0)(progn);
            var stream = (function () {
                if (v1.value1 instanceof ExitCodes.Success) {
                    return Node_Process.stdout;
                };
                return Node_Process.stderr;
            })();
            Data_Functor["void"](Effect.functorEffect)(Node_Stream.writeString(stream)(Node_Encoding.UTF8.value)(v1.value0 + "\x0a")(Data_Monoid.mempty(Effect.monoidEffect(Data_Monoid.monoidUnit))))();
            return exitWith(v1.value1)();
        };
    };
    if (v instanceof Options_Applicative_Types.CompletionInvoked) {
        return function __do() {
            var progn = getProgName();
            var msg = (Data_Newtype.un()(Options_Applicative_Types.CompletionResult)(v.value0)).execCompletion(progn)();
            Data_Functor["void"](Effect.functorEffect)(Node_Stream.writeString(Node_Process.stdout)(Node_Encoding.UTF8.value)(msg)(Data_Monoid.mempty(Effect.monoidEffect(Data_Monoid.monoidUnit))))();
            return exitSuccess();
        };
    };
    throw new Error("Failed pattern match at Options.Applicative.Extra (line 110, column 1 - line 110, column 58): " + [ v.constructor.name ]);
};
var execParserPure = function (pprefs) {
    return function (pinfo) {
        return function (args) {
            var pinfo$prime = Data_Newtype.over()()(Options_Applicative_Types.ParserInfo)(function (i) {
                return {
                    infoParser: Control_Alt.alt(Options_Applicative_Types.parserAlt)(Data_Functor.map(Options_Applicative_Types.parserFunctor)(Data_Either.Left.create)(Options_Applicative_BashCompletion.bashCompletionParser(pinfo)(pprefs)))(Data_Functor.map(Options_Applicative_Types.parserFunctor)(Data_Either.Right.create)(i.infoParser)),
                    infoFailureCode: i.infoFailureCode,
                    infoFooter: i.infoFooter,
                    infoFullDesc: i.infoFullDesc,
                    infoHeader: i.infoHeader,
                    infoPolicy: i.infoPolicy,
                    infoProgDesc: i.infoProgDesc
                };
            })(pinfo);
            var p = Options_Applicative_Common.runParserInfo(Options_Applicative_Internal.pMonadP)(pinfo$prime)(Data_List.fromFoldable(Data_Foldable.foldableArray)(args));
            var v = Options_Applicative_Internal.runP(p)(pprefs);
            if (v.value0 instanceof Data_Either.Right && v.value0.value0 instanceof Data_Either.Right) {
                return new Options_Applicative_Types.Success(v.value0.value0.value0);
            };
            if (v.value0 instanceof Data_Either.Right && v.value0.value0 instanceof Data_Either.Left) {
                return new Options_Applicative_Types.CompletionInvoked(v.value0.value0.value0);
            };
            if (v.value0 instanceof Data_Either.Left) {
                return Options_Applicative_Types.Failure.create(parserFailure(pprefs)(pinfo)(v.value0.value0)(v.value1));
            };
            throw new Error("Failed pattern match at Options.Applicative.Extra (line 144, column 3 - line 147, column 73): " + [ v.constructor.name ]);
        };
    };
};
var customExecParser = function (pprefs) {
    return function (pinfo) {
        return Control_Bind.bind(Effect.bindEffect)(Data_Functor.map(Effect.functorEffect)(execParserPure(pprefs)(pinfo))(getArgs))(handleParseResult);
    };
};
var execParser = customExecParser(Options_Applicative_Builder.defaultPrefs);
module.exports = {
    helper: helper,
    hsubparser: hsubparser,
    execParser: execParser,
    customExecParser: customExecParser,
    execParserPure: execParserPure,
    getParseResult: getParseResult,
    handleParseResult: handleParseResult,
    parserFailure: parserFailure,
    renderFailure: renderFailure
};
