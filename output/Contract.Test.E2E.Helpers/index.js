// Generated by purs version 0.14.5
"use strict";
var $foreign = require("./foreign.js");
var Contract_Test_E2E_Feedback = require("../Contract.Test.E2E.Feedback/index.js");
var Control_Alt = require("../Control.Alt/index.js");
var Control_Applicative = require("../Control.Applicative/index.js");
var Control_Bind = require("../Control.Bind/index.js");
var Control_Monad_Error_Class = require("../Control.Monad.Error.Class/index.js");
var Control_Promise = require("../Control.Promise/index.js");
var Data_Array = require("../Data.Array/index.js");
var Data_Boolean = require("../Data.Boolean/index.js");
var Data_Either = require("../Data.Either/index.js");
var Data_Foldable = require("../Data.Foldable/index.js");
var Data_Function = require("../Data.Function/index.js");
var Data_Functor = require("../Data.Functor/index.js");
var Data_Maybe = require("../Data.Maybe/index.js");
var Data_Monoid = require("../Data.Monoid/index.js");
var Data_Newtype = require("../Data.Newtype/index.js");
var Data_Semigroup = require("../Data.Semigroup/index.js");
var Data_Show = require("../Data.Show/index.js");
var Data_String_CodeUnits = require("../Data.String.CodeUnits/index.js");
var Data_String_Pattern = require("../Data.String.Pattern/index.js");
var Data_Traversable = require("../Data.Traversable/index.js");
var Data_Unit = require("../Data.Unit/index.js");
var Effect = require("../Effect/index.js");
var Effect_Aff = require("../Effect.Aff/index.js");
var Effect_Class = require("../Effect.Class/index.js");
var Effect_Console = require("../Effect.Console/index.js");
var Effect_Exception = require("../Effect.Exception/index.js");
var Effect_Ref = require("../Effect.Ref/index.js");
var Foreign = require("../Foreign/index.js");
var Helpers = require("../Helpers/index.js");
var Toppokki = require("../Toppokki/index.js");
var WalletPassword = function (x) {
    return x;
};
var Selector = function (x) {
    return x;
};
var PageError = (function () {
    function PageError() {

    };
    PageError.value = new PageError();
    return PageError;
})();
var Console = (function () {
    function Console() {

    };
    Console.value = new Console();
    return Console;
})();
var RequestFailed = (function () {
    function RequestFailed() {

    };
    RequestFailed.value = new RequestFailed();
    return RequestFailed;
})();
var ExtensionId = function (x) {
    return x;
};
var E2EOutput = function (x) {
    return x;
};
var Action = function (x) {
    return x;
};
var newtypeWalletPassword_ = {
    Coercible0: function () {
        return undefined;
    }
};
var newtypeSelector_ = {
    Coercible0: function () {
        return undefined;
    }
};
var newtypeExtensionId_ = {
    Coercible0: function () {
        return undefined;
    }
};
var newtypeAction_ = {
    Coercible0: function () {
        return undefined;
    }
};
var eqOutputType = {
    eq: function (x) {
        return function (y) {
            if (x instanceof PageError && y instanceof PageError) {
                return true;
            };
            if (x instanceof Console && y instanceof Console) {
                return true;
            };
            if (x instanceof RequestFailed && y instanceof RequestFailed) {
                return true;
            };
            return false;
        };
    }
};
var typeInto = function (selector) {
    return function (text) {
        return function (page) {
            return Control_Promise.toAffE($foreign["_typeInto"](selector)(text)(page));
        };
    };
};
var signTimeout = 50.0;
var showOutput = function (ref) {
    var showType = function (v) {
        if (v instanceof PageError) {
            return "ERR";
        };
        if (v instanceof Console) {
            return "...";
        };
        if (v instanceof RequestFailed) {
            return "REQ";
        };
        throw new Error("Failed pattern match at Contract.Test.E2E.Helpers (line 144, column 3 - line 144, column 35): " + [ v.constructor.name ]);
    };
    var show$prime = function (v) {
        return showType(v.outputType) + (" " + v.output);
    };
    return Control_Bind.bind(Effect.bindEffect)(Effect_Ref.read(ref))((function () {
        var $65 = Control_Applicative.pure(Effect.applicativeEffect);
        var $66 = Data_Foldable.intercalate(Data_Foldable.foldableArray)(Data_Monoid.monoidString)("\x0a");
        var $67 = Data_Functor.map(Data_Functor.functorArray)(show$prime);
        return function ($68) {
            return $65($66($67($68)));
        };
    })());
};
var retrieveJQuery = function ($69) {
    return Control_Promise.toAffE($foreign["_retrieveJQuery"]($69));
};
var startExample = function (url) {
    return function (browser) {
        var handler = function (errorRef) {
            return function (outputType) {
                return function (f) {
                    return function (e) {
                        return Effect_Aff.launchAff_(Control_Bind.bind(Effect_Aff.bindAff)(f(e))(function (output) {
                            return Effect_Class.liftEffect(Effect_Aff.monadEffectAff)(Effect_Ref.modify_(function (v) {
                                return Data_Semigroup.append(Data_Semigroup.semigroupArray)(v)([ {
                                    outputType: outputType,
                                    output: output
                                } ]);
                            })(errorRef));
                        }))();
                    };
                };
            };
        };
        return Control_Bind.bind(Effect_Aff.bindAff)(Toppokki.newPage(browser))(function (page) {
            return Control_Bind.bind(Effect_Aff.bindAff)(retrieveJQuery(page))(function (jQuery) {
                return Control_Bind.bind(Effect_Aff.bindAff)(Effect_Class.liftEffect(Effect_Aff.monadEffectAff)(Effect_Ref["new"]([  ])))(function (errorRef) {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(Effect_Class.liftEffect(Effect_Aff.monadEffectAff)(function __do() {
                        Toppokki.onPageError(handler(errorRef)(PageError.value)((function () {
                            var $70 = Control_Applicative.pure(Effect_Aff.applicativeAff);
                            var $71 = Data_Show.show(Effect_Exception.showError);
                            return function ($72) {
                                return $70($71($72));
                            };
                        })()))(page)();
                        Toppokki.onConsole(handler(errorRef)(Console.value)(Toppokki.consoleMessageText))(page)();
                        return Toppokki.onRequestFailed(handler(errorRef)(RequestFailed.value)((function () {
                            var $73 = Control_Applicative.pure(Effect_Aff.applicativeAff);
                            var $74 = Data_Show.show(Effect_Exception.showError);
                            return function ($75) {
                                return $73($74($75));
                            };
                        })()))(page)();
                    }))(function () {
                        return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(Toppokki["goto"](url)(page))(function () {
                            return Control_Applicative.pure(Effect_Aff.applicativeAff)({
                                browser: browser,
                                jQuery: jQuery,
                                main: page,
                                errors: errorRef
                            });
                        });
                    });
                });
            });
        });
    };
};
var withExample = function (url) {
    return function (browser) {
        return Effect_Aff.bracket(startExample(url)(browser))(Data_Function["const"](Control_Applicative.pure(Effect_Aff.applicativeAff)(Data_Unit.unit)));
    };
};
var reactSetValue = function (selector) {
    return function (value) {
        return function (page) {
            return Data_Functor["void"](Effect_Aff.functorAff)(Data_Function.flip(Toppokki.unsafeEvaluateStringFunction)(page)(Data_Foldable.fold(Data_Foldable.foldableArray)(Data_Monoid.monoidString)([ "let input = $('" + (Data_Newtype.unwrap()(selector) + "').get(0);"), "var nativeInputValueSetter = " + " Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, 'value').set;", "nativeInputValueSetter.call(input, '" + (value + "');"), "var ev2 = new Event('input', { bubbles: true});", "input.dispatchEvent(ev2);" ])));
        };
    };
};
var password = Data_Newtype.wrap()(":password");
var pageUrl = function (page) {
    return Data_Functor.map(Effect_Aff.functorAff)(Foreign.unsafeFromForeign)(Toppokki.unsafeEvaluateStringFunction("document.location.href")(page));
};
var inputType = function (typ) {
    return Data_Newtype.wrap()("input[type=\"" + (typ + "\"]"));
};
var injectJQuery = function (page) {
    return function (jQuery) {
        return Control_Bind.bind(Effect_Aff.bindAff)(Data_Functor.map(Effect_Aff.functorAff)(Foreign.unsafeFromForeign)(Toppokki.unsafeEvaluateStringFunction("typeof(jQuery) !== 'undefined'")(page)))(function (v) {
            return Control_Applicative.unless(Effect_Aff.applicativeAff)(v)(Data_Functor["void"](Effect_Aff.functorAff)(Toppokki.unsafeEvaluateStringFunction(jQuery)(page)));
        });
    };
};
var isJQuerySelectorAvailable = function (selector) {
    return function (page) {
        return function (jQuery) {
            return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(injectJQuery(page)(jQuery))(function () {
                return Data_Functor.map(Effect_Aff.functorAff)(Foreign.unsafeFromForeign)(Toppokki.unsafeEvaluateStringFunction("!!$('" + (Data_Newtype.unwrap()(selector) + "').length"))(page));
            });
        };
    };
};
var flintSign = function (v) {
    return function (v1) {
        return function (v2) {
            return Effect_Class.liftEffect(Effect_Aff.monadEffectAff)(Effect_Exception["throw"]("Flint support is not implemented"));
        };
    };
};
var flintConfirmAccess = function (v) {
    return function (v1) {
        return Effect_Class.liftEffect(Effect_Aff.monadEffectAff)(Effect_Exception["throw"]("Flint support is not implemented"));
    };
};
var findWalletPage = function (pattern) {
    return function (browser) {
        return Control_Bind.bind(Effect_Aff.bindAff)(Toppokki.pages(browser))(function (pages) {
            return Control_Bind.bind(Effect_Aff.bindAff)(Data_Functor.map(Effect_Aff.functorAff)(Data_Foldable.fold(Data_Foldable.foldableArray)(Data_Monoid.monoidArray))(Data_Traversable["for"](Effect_Aff.applicativeAff)(Data_Traversable.traversableArray)(pages)(function (page) {
                return Data_Functor.mapFlipped(Effect_Aff.functorAff)(Control_Monad_Error_Class["try"](Effect_Aff.monadErrorAff)(pageUrl(page)))(function ($76) {
                    return (function (v) {
                        if (v instanceof Data_Maybe.Nothing) {
                            return [  ];
                        };
                        if (v instanceof Data_Maybe.Just) {
                            if (Data_String_CodeUnits.contains(pattern)(v.value0)) {
                                return [ page ];
                            };
                            if (Data_Boolean.otherwise) {
                                return [  ];
                            };
                        };
                        throw new Error("Failed pattern match at Contract.Test.E2E.Helpers (line 82, column 37 - line 86, column 26): " + [ v.constructor.name ]);
                    })(Data_Either.hush($76));
                });
            })))(function (walletPages) {
                if (walletPages.length === 0) {
                    return Control_Applicative.pure(Effect_Aff.applicativeAff)(Data_Maybe.Nothing.value);
                };
                if (walletPages.length === 1) {
                    return Control_Applicative.pure(Effect_Aff.applicativeAff)(new Data_Maybe.Just(walletPages[0]));
                };
                return Control_Bind.bind(Effect_Aff.bindAff)(Data_Traversable["for"](Effect_Aff.applicativeAff)(Data_Traversable.traversableArray)(pages)(pageUrl))(function (urls) {
                    return Effect_Class.liftEffect(Effect_Aff.monadEffectAff)(Effect_Exception["throw"]("findWalletPage: more than one page found when trying to find " + ("the wallet popup. URLs: " + (Data_Foldable.intercalate(Data_Foldable.foldableArray)(Data_Monoid.monoidString)(", ")(urls) + ("; URL pattern: " + Data_Show.show(Data_Show.showString)(Data_Newtype.unwrap()(pattern)))))));
                });
            });
        });
    };
};
var doJQ = function (selector) {
    return function (action) {
        return function (page) {
            var jq = "$('" + (Data_Newtype.unwrap()(selector) + ("')." + Data_Newtype.unwrap()(action)));
            return Toppokki.unsafeEvaluateStringFunction(jq)(page);
        };
    };
};
var delaySec = function (seconds) {
    return Effect_Aff.delay(Data_Newtype.wrap()(seconds * 1000.0));
};
var waitForTestFeedback = function (v) {
    return function (timeout) {
        if (timeout <= 0.0) {
            return Control_Applicative.pure(Effect_Aff.applicativeAff)(Data_Unit.unit);
        };
        if (Data_Boolean.otherwise) {
            var isError = function (v1) {
                return Data_Array.elem(eqOutputType)(v1.outputType)([ PageError.value, RequestFailed.value ]);
            };
            return Control_Bind.bind(Effect_Aff.bindAff)(Control_Alt.alt(Effect_Aff.altAff)(Contract_Test_E2E_Feedback.testFeedbackIsTrue(v.main))(Data_Functor.map(Effect_Aff.functorAff)(Data_Array.any(isError))(Effect_Class.liftEffect(Effect_Aff.monadEffectAff)(Effect_Ref.read(v.errors)))))(function (done) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(delaySec(1.0))(function () {
                    return Control_Applicative.when(Effect_Aff.applicativeAff)(!done)(waitForTestFeedback(v)(timeout - 1.0));
                });
            });
        };
        throw new Error("Failed pattern match at Contract.Test.E2E.Helpers (line 206, column 1 - line 206, column 60): " + [ v.constructor.name, timeout.constructor.name ]);
    };
};
var waitForWalletPage = function (pattern) {
    return function (timeout) {
        return function (browser) {
            return Control_Bind.bind(Effect_Aff.bindAff)(findWalletPage(pattern)(browser))(function (v) {
                if (v instanceof Data_Maybe.Nothing) {
                    var $43 = timeout > 0.0;
                    if ($43) {
                        return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(delaySec(0.1))(function () {
                            return waitForWalletPage(pattern)(timeout - 0.1)(browser);
                        });
                    };
                    return Effect_Class.liftEffect(Effect_Aff.monadEffectAff)(Effect_Exception["throw"]("Wallet popup did not open. Did you provide extension ID correctly? " + ("Provided pattern: " + Data_Newtype.unwrap()(pattern))));
                };
                if (v instanceof Data_Maybe.Just) {
                    return Control_Applicative.pure(Effect_Aff.applicativeAff)(v.value0);
                };
                throw new Error("Failed pattern match at Contract.Test.E2E.Helpers (line 110, column 38 - line 119, column 27): " + [ v.constructor.name ]);
            });
        };
    };
};
var inWalletPage = function (pattern) {
    return function (v) {
        return function (timeout) {
            return function (cont) {
                return Control_Bind.bind(Effect_Aff.bindAff)(waitForWalletPage(pattern)(timeout)(v.browser))(function (page) {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(injectJQuery(page)(v.jQuery))(function () {
                        return cont(page);
                    });
                });
            };
        };
    };
};
var inWalletPageOptional = function (extId) {
    return function (pattern) {
        return function (v) {
            return function (timeout) {
                return function (cont) {
                    var acquirePage = Control_Bind.bind(Effect_Aff.bindAff)(waitForWalletPage(Data_String_Pattern.Pattern(Data_Newtype.unwrap()(extId)))(timeout)(v.browser))(function (page) {
                        return Control_Bind.bind(Effect_Aff.bindAff)(Helpers.liftedM(Effect_Aff.monadErrorAff)(Effect_Exception.error("inWalletPageOptional: page closed"))(Data_Functor.map(Effect_Aff.functorAff)(Data_Either.hush)(Control_Monad_Error_Class["try"](Effect_Aff.monadErrorAff)(pageUrl(page)))))(function (url) {
                            var $56 = Data_String_CodeUnits.contains(pattern)(url);
                            if ($56) {
                                return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(injectJQuery(page)(v.jQuery))(function () {
                                    return Data_Functor.map(Effect_Aff.functorAff)(Data_Maybe.Just.create)(cont(page));
                                });
                            };
                            return Control_Applicative.pure(Effect_Aff.applicativeAff)(Data_Maybe.Nothing.value);
                        });
                    });
                    return Data_Functor.mapFlipped(Effect_Aff.functorAff)(Control_Monad_Error_Class["try"](Effect_Aff.monadErrorAff)(acquirePage))(Data_Either.fromRight(Data_Maybe.Nothing.value));
                };
            };
        };
    };
};
var waitForWalletPageClose = function (pattern) {
    return function (timeout) {
        return function (browser) {
            return Control_Bind.bind(Effect_Aff.bindAff)(findWalletPage(pattern)(browser))(function (v) {
                if (v instanceof Data_Maybe.Nothing) {
                    return Control_Applicative.pure(Effect_Aff.applicativeAff)(Data_Unit.unit);
                };
                if (v instanceof Data_Maybe.Just) {
                    var $60 = timeout > 0.0;
                    if ($60) {
                        return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(delaySec(0.1))(function () {
                            return waitForWalletPageClose(pattern)(timeout - 0.1)(browser);
                        });
                    };
                    return Effect_Class.liftEffect(Effect_Aff.monadEffectAff)(Effect_Exception["throw"]("Wallet popup did not close. Did you provide extension ID correctly? " + ("Provided pattern: " + Data_Newtype.unwrap()(pattern))));
                };
                throw new Error("Failed pattern match at Contract.Test.E2E.Helpers (line 124, column 38 - line 134, column 28): " + [ v.constructor.name ]);
            });
        };
    };
};
var confirmAccessTimeout = 10.0;
var click = Data_Newtype.wrap()("click()");
var eternlSign = function (extId) {
    return function (wpassword) {
        return function (re) {
            var pattern = Data_Newtype.wrap()(Data_Newtype.unwrap()(extId) + "/www/index.html#/signtx");
            return inWalletPage(pattern)(re)(signTimeout)(function (page) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(Data_Functor["void"](Effect_Aff.functorAff)(Toppokki.pageWaitForSelector()(Data_Newtype.wrap()(Data_Newtype.unwrap()(inputType("password"))))({})(page)))(function () {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(delaySec(0.1))(function () {
                        return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(typeInto(inputType("password"))(Data_Newtype.unwrap()(wpassword))(page))(function () {
                            return Data_Functor["void"](Effect_Aff.functorAff)(doJQ(Data_Newtype.wrap()("span.capitalize:contains(\"sign\")"))(click)(page));
                        });
                    });
                });
            });
        };
    };
};
var checkSuccess = function (v) {
    return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(waitForTestFeedback(v)(80.0))(function () {
        return Control_Bind.bind(Effect_Aff.bindAff)(Contract_Test_E2E_Feedback.testFeedbackIsTrue(v.main))(function (feedback) {
            return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(Control_Applicative.unless(Effect_Aff.applicativeAff)(feedback)(Effect_Class.liftEffect(Effect_Aff.monadEffectAff)(Control_Bind.bind(Effect.bindEffect)(showOutput(v.errors))(Effect_Console.log))))(function () {
                return Control_Applicative.pure(Effect_Aff.applicativeAff)(feedback);
            });
        });
    });
};
var byId = (function () {
    var $77 = Data_Newtype.wrap();
    return function ($78) {
        return $77((function (v) {
            return "#" + v;
        })($78));
    };
})();
var buttonWithText = function (text) {
    return Data_Newtype.wrap()("button:contains(" + (text + ")"));
};
var clickButton = function (buttonText) {
    return Data_Functor.map(Data_Functor.functorFn)(Data_Functor["void"](Effect_Aff.functorAff))(doJQ(buttonWithText(buttonText))(click));
};
var eternlConfirmAccess = function (extId) {
    return function (re) {
        var pattern = Data_Newtype.wrap()(Data_Newtype.unwrap()(extId) + "/www/index.html#/connect/");
        return Control_Bind.bind(Effect_Aff.bindAff)(Data_Functor.map(Effect_Aff.functorAff)(Data_Maybe.isJust)(inWalletPageOptional(extId)(pattern)(re)(confirmAccessTimeout)(function (page) {
            return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(delaySec(1.0))(function () {
                return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(Data_Functor["void"](Effect_Aff.functorAff)(Toppokki.pageWaitForSelector()(Data_Newtype.wrap()("span.capitalize"))({})(page)))(function () {
                    return clickButton("Connect to Site")(page);
                });
            });
        })))(function (wasInPage) {
            return Control_Applicative.when(Effect_Aff.applicativeAff)(wasInPage)(waitForWalletPageClose(pattern)(10.0)(re.browser));
        });
    };
};
var geroSign = function (extId) {
    return function (gpassword) {
        return function (re) {
            return inWalletPage(Data_Newtype.wrap()(Data_Newtype.unwrap()(extId)))(re)(signTimeout)(function (gero) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(Data_Functor["void"](Effect_Aff.functorAff)(doJQ(byId("confirm-swap"))(click)(gero)))(function () {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(typeInto(byId("wallet-password"))(Data_Newtype.unwrap()(gpassword))(gero))(function () {
                        return clickButton("Next")(gero);
                    });
                });
            });
        };
    };
};
var namiConfirmAccess = function (extId) {
    return function (re) {
        return inWalletPage(Data_Newtype.wrap()(Data_Newtype.unwrap()(extId)))(re)(confirmAccessTimeout)(clickButton("Access"));
    };
};
var namiSign = function (extId) {
    return function (wpassword) {
        return function (re) {
            return inWalletPage(Data_Newtype.wrap()(Data_Newtype.unwrap()(extId)))(re)(signTimeout)(function (nami) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(clickButton("Sign")(nami))(function () {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(reactSetValue(password)(Data_Newtype.unwrap()(wpassword))(nami))(function () {
                        return clickButton("Confirm")(nami);
                    });
                });
            });
        };
    };
};
var geroConfirmAccess = function (extId) {
    return function (re) {
        return inWalletPage(Data_Newtype.wrap()(Data_Newtype.unwrap()(extId)))(re)(confirmAccessTimeout)(function (page) {
            return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(delaySec(0.1))(function () {
                return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(Data_Functor["void"](Effect_Aff.functorAff)(doJQ(inputType("radio"))(click)(page)))(function () {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(Data_Functor["void"](Effect_Aff.functorAff)(doJQ(buttonWithText("Continue"))(click)(page)))(function () {
                        return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(delaySec(0.1))(function () {
                            return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(Data_Functor["void"](Effect_Aff.functorAff)(doJQ(inputType("checkbox"))(click)(page)))(function () {
                                return Data_Functor["void"](Effect_Aff.functorAff)(doJQ(buttonWithText("Connect"))(click)(page));
                            });
                        });
                    });
                });
            });
        });
    };
};
var lodeConfirmAccess = function (extId) {
    return function (re) {
        var pattern = Data_String_Pattern.Pattern(Data_Newtype.unwrap()(extId));
        return Control_Bind.bind(Effect_Aff.bindAff)(inWalletPage(pattern)(re)(confirmAccessTimeout)(function (page) {
            return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(delaySec(0.1))(function () {
                return Control_Bind.bind(Effect_Aff.bindAff)(isJQuerySelectorAvailable(buttonWithText("Access"))(page)(re.jQuery))(function (isOnAccessPage) {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(Control_Applicative.when(Effect_Aff.applicativeAff)(isOnAccessPage)(Data_Functor["void"](Effect_Aff.functorAff)(doJQ(buttonWithText("Access"))(click)(page))))(function () {
                        return Control_Applicative.pure(Effect_Aff.applicativeAff)(isOnAccessPage);
                    });
                });
            });
        }))(function (wasOnAccessPage) {
            return Control_Applicative.when(Effect_Aff.applicativeAff)(wasOnAccessPage)(waitForWalletPageClose(pattern)(10.0)(re.browser));
        });
    };
};
var lodeSign = function (extId) {
    return function (gpassword) {
        return function (re) {
            return inWalletPage(Data_Newtype.wrap()(Data_Newtype.unwrap()(extId)))(re)(signTimeout)(function (page) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(Data_Functor["void"](Effect_Aff.functorAff)(Toppokki.pageWaitForSelector()(Data_Newtype.wrap()(Data_Newtype.unwrap()(inputType("password"))))({})(page)))(function () {
                    return Control_Bind.bind(Effect_Aff.bindAff)(isJQuerySelectorAvailable(buttonWithText("Approve"))(page)(re.jQuery))(function (isOnSignPage) {
                        return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(Control_Applicative.unless(Effect_Aff.applicativeAff)(isOnSignPage)(Effect_Class.liftEffect(Effect_Aff.monadEffectAff)(Effect_Exception["throw"]("lodeSign: unable to find signing page"))))(function () {
                            return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(typeInto(inputType("password"))(Data_Newtype.unwrap()(gpassword))(page))(function () {
                                return Control_Bind.discard(Control_Bind.discardUnit)(Effect_Aff.bindAff)(delaySec(0.1))(function () {
                                    return clickButton("Approve")(page);
                                });
                            });
                        });
                    });
                });
            });
        };
    };
};
module.exports = {
    ExtensionId: ExtensionId,
    WalletPassword: WalletPassword,
    checkSuccess: checkSuccess,
    delaySec: delaySec,
    eternlConfirmAccess: eternlConfirmAccess,
    eternlSign: eternlSign,
    geroConfirmAccess: geroConfirmAccess,
    geroSign: geroSign,
    flintConfirmAccess: flintConfirmAccess,
    flintSign: flintSign,
    lodeConfirmAccess: lodeConfirmAccess,
    lodeSign: lodeSign,
    namiConfirmAccess: namiConfirmAccess,
    namiSign: namiSign,
    withExample: withExample,
    newtypeWalletPassword_: newtypeWalletPassword_,
    newtypeExtensionId_: newtypeExtensionId_
};
